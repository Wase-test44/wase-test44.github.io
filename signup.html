<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEM Official Signup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --secondary: #006400;
            --light: #f5f8ff;
            --accent: #388e3c;
            --error: #d32f2f;
        }
        
        body {
            background: linear-gradient(135deg, #e6f4ea, #f0f7da);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .signup-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .banner-section {
            background: linear-gradient(rgba(46, 125, 50, 0.9), rgba(0, 100, 0, 0.9)), 
                        url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=1000') center/cover;
            padding: 40px;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .banner-content {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }
        
        .banner-content h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .feature-list {
            text-align: left;
            margin-top: 30px;
        }
        
        .feature {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
        }
        
        .feature-icon {
            background: var(--primary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .signup-section {
            padding: 40px;
        }
        
        .logo-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo-header img {
            height: 70px;
            margin-bottom: 15px;
        }
        
        .logo-header h2 {
            color: var(--secondary);
            font-weight: 700;
        }
        
        .form-container {
            background: white;
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-header h3 {
            color: var(--secondary);
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 20px;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: var(--primary);
            transform: translateY(-50%);
            z-index: 2;
            transition: width 0.4s ease;
        }
        
        .step {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }
        
        .step-label {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.85rem;
            color: #666;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full {
            grid-column: span 2;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        label.required::after {
            content: " *";
            color: var(--error);
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }
        
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(46, 125, 50, 0.05);
        }
        
        .preview-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .preview-box {
            text-align: center;
        }
        
        .preview-image {
            width: 120px;
            height: 120px;
            border: 1px solid #ddd;
            border-radius: 8px;
            object-fit: cover;
            display: none;
        }
        
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(46, 125, 50, 0.1);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .error {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 6px;
            display: none;
        }
        
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .debug-title {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .debug-content {
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .debug-entry {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-success {
            background: var(--primary);
        }
        
        .status-error {
            background: var(--error);
        }
        
        .status-processing {
            background: #ffc107;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 40px;
            text-align: center;
            transform: translateY(-20px);
            transition: all 0.4s ease;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-icon {
            font-size: 60px;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .modal-loader {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(46, 125, 50, 0.2);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .banner-section {
                padding: 30px 20px;
            }
            
            .signup-section {
                padding: 30px;
            }
            
            .preview-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="signup-container">
        <div class="row g-0">
            <div class="col-lg-5">
                <div class="banner-section">
                    <div class="banner-content">
                        <h1>Join Our Movement</h1>
                        <p>Become part of a transformative journey to empower communities and preserve our heritage across Northern Nigeria.</p>
                        
                        <div class="feature-list">
                            <div class="feature">
                                <div class="feature-icon">✓</div>
                                <div>Contribute to meaningful environmental initiatives</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">✓</div>
                                <div>Access exclusive training and resources</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">✓</div>
                                <div>Network with professionals and community leaders</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">✓</div>
                                <div>Participate in cultural preservation projects</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div class="signup-section">
                    <div class="logo-header">
                        <img src="https://wase-test44.github.io/APEM.jpg" alt="APEM Logo">
                        <h2>AREWA Progressive Eagle Movement</h2>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-steps">
                            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                            <div class="step active" id="step1">1</div>
                            <div class="step" id="step2">2</div>
                            <div class="step" id="step3">3</div>
                            <div class="step" id="step4">4</div>
                        </div>
                    </div>
                    
                    <form id="signupForm">
                        <!-- Step 1: Account Information -->
                        <div class="form-step active" id="step1-form">
                            <div class="form-header">
                                <h3>Account Information</h3>
                                <p>Create your login credentials</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="position" class="required">Official Position</label>
                                    <input type="text" id="position" placeholder="e.g. Secretary, Coordinator" required>
                                    <div class="error" id="positionError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="passkeyInput" class="required">Passkey</label>
                                    <input type="password" id="passkeyInput" placeholder="Enter your passkey" required>
                                    <div class="error" id="passkeyError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="email" class="required">Email Address</label>
                                    <input type="email" id="email" placeholder="your.email@example.com" required>
                                    <div class="error" id="emailError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="password" class="required">Password</label>
                                    <input type="password" id="password" placeholder="At least 8 characters" required>
                                    <div class="error" id="passwordError"></div>
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <div></div> <!-- Empty spacer -->
                                <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 2: Personal Information -->
                        <div class="form-step" id="step2-form">
                            <div class="form-header">
                                <h3>Personal Information</h3>
                                <p>Tell us about yourself</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="surname" class="required">Surname</label>
                                    <input type="text" id="surname" placeholder="Enter your surname" required>
                                    <div class="error" id="surnameError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="firstname" class="required">First Name</label>
                                    <input type="text" id="firstname" placeholder="Enter your first name" required>
                                    <div class="error" id="firstnameError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="othername">Other Names</label>
                                    <input type="text" id="othername" placeholder="Enter other names">
                                </div>
                                
                                <div class="form-group">
                                    <label for="dob" class="required">Date of Birth</label>
                                    <input type="date" id="dob" min="1950-01-01" max="2005-01-01" required>
                                    <div class="error" id="dobError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="gender" class="required">Gender</label>
                                    <select id="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                    <div class="error" id="genderError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="phone" class="required">Phone Number</label>
                                    <input type="tel" id="phone" placeholder="+234 800 000 0000" required>
                                    <div class="error" id="phoneError"></div>
                                </div>
                                
                                <div class="form-group full">
                                    <label for="address" class="required">Contact Address</label>
                                    <input type="text" id="address" placeholder="Full residential address" required>
                                    <div class="error" id="addressError"></div>
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline" onclick="prevStep(1)">Back</button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Origin & Education -->
                        <div class="form-step" id="step3-form">
                            <div class="form-header">
                                <h3>Origin & Education</h3>
                                <p>Your background information</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="state" class="required">State of Origin</label>
                                    <select id="state" onchange="loadLGAs()" required>
                                        <option value="">Select State</option>
                                        <option value="Adamawa">Adamawa</option>
                                        <option value="Bauchi">Bauchi</option>
                                        <option value="Benue">Benue</option>
                                        <option value="Borno">Borno</option>
                                        <option value="FCT">FCT</option>
                                        <option value="Gombe">Gombe</option>
                                        <option value="Jigawa">Jigawa</option>
                                        <option value="Kaduna">Kaduna</option>
                                        <option value="Kano">Kano</option>
                                        <option value="Katsina">Katsina</option>
                                        <option value="Kebbi">Kebbi</option>
                                        <option value="Kogi">Kogi</option>
                                        <option value="Kwara">Kwara</option>
                                        <option value="Nasarawa">Nasarawa</option>
                                        <option value="Niger">Niger</option>
                                        <option value="Plateau">Plateau</option>
                                        <option value="Sokoto">Sokoto</option>
                                        <option value="Taraba">Taraba</option>
                                        <option value="Yobe">Yobe</option>
                                        <option value="Zamfara">Zamfara</option>
                                    </select>
                                    <div class="error" id="stateError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="lga" class="required">LGA of Origin</label>
                                    <select id="lga" required>
                                        <option value="">Select LGA</option>
                                    </select>
                                    <div class="error" id="lgaError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="qualification" class="required">Highest Qualification</label>
                                    <input type="text" id="qualification" placeholder="e.g. BSc, MSc, PhD" required>
                                    <div class="error" id="qualificationError"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="grad_year" class="required">Year Obtained</label>
                                    <input type="text" id="grad_year" placeholder="e.g. 2015" required>
                                    <div class="error" id="gradYearError"></div>
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline" onclick="prevStep(2)">Back</button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(4)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 4: Documents & Confirmation -->
                        <div class="form-step" id="step4-form">
                            <div class="form-header">
                                <h3>Documents & Confirmation</h3>
                                <p>Upload required documents</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group full">
                                    <label class="required">Upload Passport Photo</label>
                                    <div class="file-upload" id="passportUpload">
                                        <input type="file" id="passport" accept="image/*" required style="display: none;">
                                        <p>Click to upload passport photo</p>
                                        <small>JPG or PNG, Max 2MB</small>
                                    </div>
                                    <div class="error" id="passportError"></div>
                                </div>
                                
                                <div class="form-group full">
                                    <label class="required">Upload NIN Document</label>
                                    <div class="file-upload" id="ninUpload">
                                        <input type="file" id="nin" accept="image/*" required style="display: none;">
                                        <p>Click to upload NIN document</p>
                                        <small>JPG or PNG, Max 2MB</small>
                                    </div>
                                    <div class="error" id="ninError"></div>
                                </div>
                                
                                <div class="form-group full">
                                    <div class="preview-container">
                                        <div class="preview-box">
                                            <img id="passportPreview" class="preview-image" src="#" alt="Passport Preview">
                                            <small>Passport Preview</small>
                                        </div>
                                        <div class="preview-box">
                                            <img id="ninPreview" class="preview-image" src="#" alt="NIN Preview">
                                            <small>NIN Preview</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group full">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="terms" required>
                                        <label class="form-check-label" for="terms">
                                            I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline" onclick="prevStep(3)">Back</button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">Create Account</button>
                            </div>
                        </div>
                    </form>
                    
                    <div class="debug-panel">
                        <div class="debug-header">
                            <div class="debug-title">Signup Process Debug</div>
                            <button class="btn btn-outline" id="toggleDebug">Hide</button>
                        </div>
                        <div class="debug-content" id="debugContent">
                            <div class="debug-entry">
                                <span class="status-indicator status-processing"></span>
                                Waiting for signup to begin...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">✓</div>
            <h3>Account Created Successfully!</h3>
            <p>Your APEM account is ready to use.</p>
            <p>You will be redirected to your dashboard shortly.</p>
            <div class="modal-loader" id="modalLoader"></div>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL 
        } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js';
        
        import { 
            initializeApp 
        } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
        
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc 
        } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js';
        
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            setPersistence,
            browserLocalPersistence
        } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDWNLns4skz3zOyvYxIssiR0B3QSGN1li8",
            authDomain: "arewa-progressive-eagle.firebaseapp.com",
            projectId: "arewa-progressive-eagle",
            storageBucket: "arewa-progressive-eagle.appspot.com",
            messagingSenderId: "1002389077766",
            appId: "1:1002389077766:web:9af458f75b345588dea887"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        // Debug logging function
        function logDebug(message, status = "info") {
            console.log(message);
            const debugContent = document.getElementById("debugContent");
            const statusClass = {
                "info": "status-processing",
                "success": "status-success",
                "error": "status-error"
            }[status] || "";
            
            const statusIndicator = status ? `<span class="status-indicator ${statusClass}"></span>` : "";
            
            debugContent.innerHTML += `
                <div class="debug-entry">
                    ${statusIndicator}${new Date().toLocaleTimeString()}: ${message}
                </div>
            `;
            debugContent.scrollTop = debugContent.scrollHeight;
        }

        // File upload function with enhanced error handling
        async function uploadFile(file, path) {
            try {
                logDebug(`Uploading file: ${file.name} (${(file.size/1024).toFixed(1)}KB) to ${path}`, "info");
                
                // Validate file size
                if (file.size > 2 * 1024 * 1024) {
                    throw new Error("File size exceeds 2MB limit");
                }
                
                // Create storage reference
                const storageRef = ref(storage, path);
                
                // Upload file
                const uploadTask = uploadBytes(storageRef, file);
                
                // Create a timeout promise
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error("Upload timed out (10s)")), 10000)
                );
                
                // Race between upload and timeout
                await Promise.race([uploadTask, timeoutPromise]);
                
                // Get download URL
                const url = await getDownloadURL(storageRef);
                
                logDebug(`File uploaded successfully: ${url}`, "success");
                return url;
            } catch (error) {
                logDebug(`File upload error: ${error.message}`, "error");
                throw new Error(`File upload failed: ${error.message}`);
            }
        }

        // Main signup function
        async function signUp() {
            // Show modal
            document.getElementById("successModal").classList.add("active");
            
            // Reset debug
            document.getElementById("debugContent").innerHTML = "";
            logDebug("Starting signup process...", "info");
            
            // Disable submit button
            const submitBtn = document.getElementById("submitBtn");
            submitBtn.disabled = true;
            submitBtn.textContent = "Processing...";
            
            try {
                // Gather form data
                const position = document.getElementById("position").value.trim();
                const passkey = document.getElementById("passkeyInput").value.trim();
                const email = document.getElementById("email").value.trim();
                const password = document.getElementById("password").value.trim();
                const surname = document.getElementById("surname").value.trim();
                const firstname = document.getElementById("firstname").value.trim();
                const othername = document.getElementById("othername").value.trim();
                const dob = document.getElementById("dob").value;
                const gender = document.getElementById("gender").value;
                const phone = document.getElementById("phone").value.trim();
                const address = document.getElementById("address").value.trim();
                const state = document.getElementById("state").value;
                const lga = document.getElementById("lga").value;
                const qualification = document.getElementById("qualification").value.trim();
                const grad_year = document.getElementById("grad_year").value.trim();
                const passportFile = document.getElementById("passport").files[0];
                const ninFile = document.getElementById("nin").files[0];
                
                // Validate passkey
                logDebug(`Validating passkey for position: ${position}`, "info");
                const positionKey = position.toLowerCase().replace(/\s+/g, "_");
                const passkeyDoc = await getDoc(doc(db, "official_passkeys", positionKey));
                
                if (!passkeyDoc.exists()) {
                    throw new Error(`Position "${position}" not authorized for signup`);
                }
                
                if (passkeyDoc.data().passkey !== passkey) {
                    throw new Error("Invalid passkey for this position");
                }
                
                logDebug("Passkey validated successfully", "success");
                
                // Create user account
                logDebug(`Creating user account for: ${email}`, "info");
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const userId = userCredential.user.uid;
                logDebug(`User created with ID: ${userId}`, "success");
                
                // Upload files
                logDebug("Uploading passport photo...", "info");
                const passportURL = await uploadFile(passportFile, `official_passports/${userId}`);
                
                logDebug("Uploading NIN document...", "info");
                const ninURL = await uploadFile(ninFile, `official_nins/${userId}`);
                
                // Save profile data
                logDebug("Saving profile to Firestore...", "info");
                await setDoc(doc(db, "official_profiles", userId), {
                    position, 
                    surname, 
                    firstname, 
                    othername, 
                    dob, 
                    gender,
                    email, 
                    phone, 
                    address, 
                    state, 
                    lga, 
                    qualification, 
                    grad_year,
                    passportURL, 
                    ninURL,
                    createdAt: new Date()
                });
                
                logDebug("Profile saved successfully", "success");
                
                // Set authentication persistence
                logDebug("Setting authentication persistence...", "info");
                await setPersistence(auth, browserLocalPersistence);
                logDebug("Persistence set to local", "success");
                
                // Final success
                logDebug("Signup completed successfully! Redirecting to dashboard...", "success");
                
                // Redirect to dashboard after delay
                setTimeout(() => {
                    window.location.href = "dashboard.html";
                }, 3000);

            } catch (error) {
                console.error("Signup error:", error);
                logDebug(`ERROR: ${error.message}`, "error");
                
                // Hide modal
                document.getElementById("successModal").classList.remove("active");
                
                // Re-enable button with error message
                submitBtn.disabled = false;
                submitBtn.textContent = "Try Again";
                
                // Show error in UI
                alert(`Signup failed: ${error.message}`);
            }
        }

        // Form submission handler
        document.getElementById("signupForm").addEventListener("submit", function(e) {
            e.preventDefault();
            signUp();
        });

        // File upload handlers
        document.getElementById("passportUpload").addEventListener("click", function() {
            document.getElementById("passport").click();
        });
        
        document.getElementById("ninUpload").addEventListener("click", function() {
            document.getElementById("nin").click();
        });
        
        document.getElementById("passport").addEventListener("change", function() {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById("passportPreview");
                img.src = e.target.result;
                img.style.display = "block";
            };
            if (this.files[0]) reader.readAsDataURL(this.files[0]);
        });
        
        document.getElementById("nin").addEventListener("change", function() {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById("ninPreview");
                img.src = e.target.result;
                img.style.display = "block";
            };
            if (this.files[0]) reader.readAsDataURL(this.files[0]);
        });
    </script>
    
    <script>
        // Form navigation functions
        let currentStep = 1;
        
        function nextStep(step) {
            document.getElementById(`step${currentStep}-form`).classList.remove("active");
            document.getElementById(`step${currentStep}`).classList.remove("active");
            
            currentStep = step;
            
            document.getElementById(`step${currentStep}-form`).classList.add("active");
            document.getElementById(`step${currentStep}`).classList.add("active");
            
            // Update progress bar
            const progress = ((step - 1) / 3) * 100;
            document.getElementById("progressBar").style.width = `${progress}%`;
        }
        
        function prevStep(step) {
            document.getElementById(`step${currentStep}-form`).classList.remove("active");
            document.getElementById(`step${currentStep}`).classList.remove("active");
            
            currentStep = step;
            
            document.getElementById(`step${currentStep}-form`).classList.add("active");
            document.getElementById(`step${currentStep}`).classList.add("active");
            
            // Update progress bar
            const progress = ((step - 1) / 3) * 100;
            document.getElementById("progressBar").style.width = `${progress}%`;
        }
        
        // LGA data and function
        const lgaData = {
            Adamawa: ["Demsa", "Fufore", "Ganye", "Girei", "Gombi", "Guyuk", "Hong", "Jada", "Lamurde", "Madagali", "Maiha", "Mayo-Belwa", "Michika", "Mubi North", "Mubi South", "Numan", "Shelleng", "Song", "Toungo", "Yola North", "Yola South"],
            Bauchi: ["Alkaleri", "Bauchi", "Bogoro", "Damban", "Darazo", "Dass", "Gamawa", "Ganjuwa", "Giade", "Itas/Gadau", "Jama'are", "Katagum", "Kirfi", "Misau", "Ningi", "Shira", "Tafawa Balewa", "Toro", "Warji", "Zaki"],
            Benue: ["Ado", "Agatu", "Apa", "Buruku", "Gboko", "Guma", "Gwer East", "Gwer West", "Katsina-Ala", "Konshisha", "Kwande", "Logo", "Makurdi", "Obi", "Ogbadibo", "Ohimini", "Oju", "Okpokwu", "Otukpo", "Tarka", "Ukum", "Ushongo", "Vandeikya"],
            Borno: ["Abadam", "Askira/Uba", "Bama", "Bayo", "Biu", "Chibok", "Damboa", "Dikwa", "Gubio", "Guzamala", "Gwoza", "Hawul", "Jere", "Kaga", "Kala/Balge", "Konduga", "Kukawa", "Kwaya Kusar", "Mafa", "Magumeri", "Maiduguri", "Marte", "Mobbar", "Monguno", "Ngala", "Nganzai", "Shani"],
            FCT: ["Abaji", "Bwari", "Gwagwalada", "Kuje", "Kwali", "Municipal Area Council"],
            Gombe: ["Akko", "Balanga", "Billiri", "Dukku", "Funakaye", "Gombe", "Kaltungo", "Kwami", "Nafada", "Shongom", "Yamaltu/Deba"],
            Jigawa: ["Auyo", "Babura", "Biriniwa", "Birnin Kudu", "Buji", "Dutse", "Gagarawa", "Garki", "Gumel", "Guri", "Gwaram", "Gwiwa", "Hadejia", "Jahun", "Kafin Hausa", "Kaugama", "Kazaure", "Kiri Kasama", "Kiyawa", "Maigatari", "Malam Madori", "Miga", "Ringim", "Roni", "Sule Tankarkar", "Taura", "Yankwashi"],
            Kaduna: ["Birnin Gwari", "Chikun", "Giwa", "Igabi", "Ikara", "Jaba", "Jema'a", "Kachia", "Kaduna North", "Kaduna South", "Kagarko", "Kajuru", "Kaura", "Kauru", "Kubau", "Kudan", "Lere", "Makarfi", "Sabon Gari", "Sanga", "Soba", "Zangon Kataf", "Zaria"],
            Kano: ["Ajingi", "Albasu", "Bagwai", "Bebeji", "Bichi", "Bunkure", "Dala", "Dambatta", "Dawakin Kudu", "Dawakin Tofa", "Doguwa", "Fagge", "Gabasawa", "Garko", "Garun Mallam", "Gaya", "Gezawa", "Gwale", "Gwarzo", "Kabo", "Kano Municipal", "Karaye", "Kibiya", "Kiru", "Kumbotso", "Kunchi", "Kura", "Madobi", "Makoda", "Minjibir", "Nasarawa", "Rano", "Rimin Gado", "Rogo", "Shanono", "Sumaila", "Takai", "Tarauni", "Tofa", "Tsanyawa", "Tudun Wada", "Ungogo", "Warawa", "Wudil"],
            Katsina: ["Bakori", "Batagarawa", "Batsari", "Baure", "Bindawa", "Charanchi", "Dandume", "Danja", "Dan Musa", "Daura", "Dutsi", "Dutsin-Ma", "Faskari", "Funtua", "Ingawa", "Jibia", "Kafur", "Kaita", "Kankara", "Kankia", "Katsina", "Kurfi", "Kusada", "Mai'Adua", "Malumfashi", "Mani", "Mashi", "Matazu", "Musawa", "Rimi", "Sabuwa", "Safana", "Sandamu", "Zango"],
            Kebbi: ["Aleiro", "Arewa Dandi", "Argungu", "Augie", "Bagudo", "Birnin Kebbi", "Bunza", "Dandi", "Fakai", "Gwandu", "Jega", "Kalgo", "Koko/Besse", "Maiyama", "Ngaski", "Sakaba", "Shanga", "Suru", "Wasagu/Danko", "Yauri", "Zuru"],
            Kogi: ["Adavi", "Ajaokuta", "Ankpa", "Bassa", "Dekina", "Ibaji", "Idah", "Igalamela-Odolu", "Ijumu", "Kabba/Bunu", "Kogi", "Lokoja", "Mopa-Muro", "Ofu", "Ogori/Magongo", "Okehi", "Okene", "Olamaboro", "Omala", "Yagba East", "Yagba West"],
            Kwara: ["Asa", "Baruten", "Edu", "Ekiti", "Ifelodun", "Ilorin East", "Ilorin South", "Ilorin West", "Irepodun", "Isin", "Kaiama", "Moro", "Offa", "Oke Ero", "Oyun", "Pategi"],
            Nasarawa: ["Akwanga", "Awe", "Doma", "Karu", "Keana", "Keffi", "Kokona", "Lafia", "Nasarawa", "Nasarawa Egon", "Obi", "Toto", "Wamba"],
            Niger: ["Agaie", "Agwara", "Bida", "Borgu", "Bosso", "Chanchaga", "Edati", "Gbako", "Gurara", "Katcha", "Kontagora", "Lapai", "Lavun", "Magama", "Mariga", "Mashegu", "Mokwa", "Moya", "Paikoro", "Rafi", "Rijau", "Shiroro", "Suleja", "Tafa", "Wushishi"],
            Plateau: ["Barkin Ladi", "Bassa", "Bokkos", "Jos East", "Jos North", "Jos South", "Kanam", "Kanke", "Langtang North", "Langtang South", "Mangu", "Mikang", "Pankshin", "Qua'an Pan", "Riyom", "Shendam", "Wase"],
            Sokoto: ["Binji", "Bodinga", "Dange Shuni", "Gada", "Goronyo", "Gudu", "Gwadabawa", "Illela", "Isa", "Kebbe", "Kware", "Rabah", "Sabon Birni", "Shagari", "Silame", "Sokoto North", "Sokoto South", "Tambuwal", "Tangaza", "Tureta", "Wamako", "Wurno", "Yabo"],
            Taraba: ["Ardo Kola", "Bali", "Donga", "Gashaka", "Gassol", "Ibi", "Jalingo", "Karim Lamido", "Kumi", "Lau", "Sardauna", "Takum", "Ussa", "Wukari", "Yorro", "Zing"],
            Yobe: ["Bade", "Bursari", "Damaturu", "Fika", "Fune", "Geidam", "Gujba", "Gulani", "Jakusko", "Karasuwa", "Machina", "Nangere", "Nguru", "Potiskum", "Tarmuwa", "Yunusari", "Yusufari"],
            Zamfara: ["Anka", "Bakura", "Birnin Magaji/Kiyaw", "Bukkuyum", "Bungudu", "Gummi", "Gusau", "Kaura Namoda", "Maradun", "Maru", "Shinkafi", "Talata Mafara", "Chafe", "Zurmi"]
        };

        function loadLGAs() {
            const state = document.getElementById("state").value;
            const lgaSelect = document.getElementById("lga");
            
            lgaSelect.innerHTML = '<option value="">Select LGA of Origin</option>';
            
            if (lgaData[state]) {
                lgaData[state].forEach(lga => {
                    const option = document.createElement("option");
                    option.value = lga;
                    option.textContent = lga;
                    lgaSelect.appendChild(option);
                });
            }
        }
        
        // Toggle debug panel
        document.getElementById("toggleDebug").addEventListener("click", function() {
            const debugPanel = document.querySelector(".debug-panel");
            if (debugPanel.style.display === "none") {
                debugPanel.style.display = "block";
                this.textContent = "Hide";
            } else {
                debugPanel.style.display = "none";
                this.textContent = "Show";
            }
        });
    </script>
</body>
</html>
